# React æ ¸å¿ƒæ¦‚å¿µ

## ä¸€ã€React å“²å­¦ä¸æ ¸å¿ƒæ€æƒ³

### 1.1 React çš„è®¾è®¡ç†å¿µ

**æ ¸å¿ƒæ€æƒ³**
- **ç»„ä»¶åŒ–**ï¼šUI æ‹†åˆ†ä¸ºç‹¬ç«‹ã€å¯å¤ç”¨çš„ç»„ä»¶
- **å£°æ˜å¼**ï¼šæè¿°"æ˜¯ä»€ä¹ˆ"ï¼Œè€Œé"å¦‚ä½•åš"
- **å•å‘æ•°æ®æµ**ï¼šæ•°æ®ä»çˆ¶ç»„ä»¶æµå‘å­ç»„ä»¶
- **è™šæ‹Ÿ DOM**ï¼šé«˜æ•ˆçš„ DOM æ›´æ–°æœºåˆ¶

### 1.2 JSX è¯­æ³•

```jsx
// JSX æ˜¯ JavaScript çš„æ‰©å±•è¯­æ³•
const element = <h1>Hello, React!</h1>;

// JSX ä¸­çš„è¡¨è¾¾å¼
const name = 'å¼ ä¸‰';
const element = <h1>ä½ å¥½, {name}</h1>;

// å±æ€§ä½¿ç”¨é©¼å³°å‘½å
const element = <div className="container" tabIndex={0} />;

// è‡ªå®šä¹‰ç»„ä»¶ç”¨å¤§å†™å¼€å¤´
function Welcome() {
  return <h1>æ¬¢è¿</h1>;
}

const element = <Welcome />;

// æ¡ä»¶æ¸²æŸ“
function Greeting({ isLoggedIn }) {
  return (
    <div>
      {isLoggedIn ? <h1>æ¬¢è¿å›æ¥!</h1> : <h1>è¯·ç™»å½•</h1>}
    </div>
  );
}

// åˆ—è¡¨æ¸²æŸ“
function List({ items }) {
  return (
    <ul>
      {items.map((item, index) => (
        <li key={item.id || index}>
          {item.name}
        </li>
      ))}
    </ul>
  );
}
```

---

## äºŒã€å‡½æ•°ç»„ä»¶ä¸ Hooks

### 2.1 å‡½æ•°ç»„ä»¶åŸºç¡€

```jsx
// åŸºç¡€å‡½æ•°ç»„ä»¶
function Welcome(props) {
  return <h1>Hello, {props.name}</h1>;
}

// ç®­å¤´å‡½æ•°ç»„ä»¶
const Welcome = ({ name }) => {
  return <h1>Hello, {name}</h1>;
};

// ä½¿ç”¨ props é»˜è®¤å€¼
Welcome.defaultProps = {
  name: 'Guest'
};

// æˆ–ä½¿ç”¨ ES6 é»˜è®¤å‚æ•°
const Welcome = ({ name = 'Guest' }) => {
  return <h1>Hello, {name}</h1>;
};
```

### 2.2 useState - çŠ¶æ€ç®¡ç†

```jsx
import { useState } from 'react';

// åŸºç¡€ç”¨æ³•
function Counter() {
  const [count, setCount] = useState(0);

  return (
    <div>
      <p>è®¡æ•°: {count}</p>
      <button onClick={() => setCount(count + 1)}>
        å¢åŠ 
      </button>
    </div>
  );
}

// å¯¹è±¡çŠ¶æ€
function UserProfile() {
  const [user, setUser] = useState({
    name: 'å¼ ä¸‰',
    age: 25
  });

  const updateName = () => {
    // âœ… æ­£ç¡®ï¼šåˆ›å»ºæ–°å¯¹è±¡
    setUser({ ...user, name: 'æå››' });

    // âŒ é”™è¯¯ï¼šç›´æ¥ä¿®æ”¹
    // user.name = 'æå››';
    // setUser(user);
  };

  return (
    <div>
      <p>å§“å: {user.name}</p>
      <button onClick={updateName}>æ›´æ–°å§“å</button>
    </div>
  );
}

// å‡½æ•°å¼æ›´æ–°
function Counter() {
  const [count, setCount] = useState(0);

  const increment = () => {
    // å½“æ–°çŠ¶æ€åŸºäºæ—§çŠ¶æ€æ—¶ä½¿ç”¨å‡½æ•°å¼æ›´æ–°
    setCount(prevCount => prevCount + 1);
  };

  return <button onClick={increment}>{count}</button>;
}

// æƒ°æ€§åˆå§‹çŠ¶æ€
function UserProfile({ userId }) {
  const [user, setUser] = useState(() => {
    // åªåœ¨ç»„ä»¶é¦–æ¬¡æ¸²æŸ“æ—¶æ‰§è¡Œä¸€æ¬¡
    return fetchUser(userId);
  });

  return <div>{user.name}</div>;
}
```

### 2.3 useEffect - å‰¯ä½œç”¨å¤„ç†

```jsx
import { useState, useEffect } from 'react';

// æ¯æ¬¡æ¸²æŸ“åæ‰§è¡Œ
function Logger() {
  useEffect(() => {
    console.log('ç»„ä»¶æ¸²æŸ“äº†');
  });

  return <div>æ—¥å¿—ç»„ä»¶</div>;
}

// ä»…åœ¨ç»„ä»¶æŒ‚è½½æ—¶æ‰§è¡Œï¼ˆç±»ä¼¼ componentDidMountï¼‰
function DataLoader() {
  const [data, setData] = useState(null);

  useEffect(() => {
    fetchData().then(setData);
  }, []); // ç©ºä¾èµ–æ•°ç»„

  return data ? <div>{data}</div> : <div>åŠ è½½ä¸­...</div>;
}

// å“åº”ä¾èµ–å˜åŒ–
function UserProfile({ userId }) {
  const [user, setUser] = useState(null);

  useEffect(() => {
    // userId å˜åŒ–æ—¶é‡æ–°è·å–æ•°æ®
    fetchUser(userId).then(setData);
  }, [userId]);

  return user ? <div>{user.name}</div> : null;
}

// æ¸…ç†å‰¯ä½œç”¨
function Subscription({ source }) {
  useEffect(() => {
    const subscription = source.subscribe();

    // è¿”å›æ¸…ç†å‡½æ•°
    return () => {
      subscription.unsubscribe();
    };
  }, [source]);

  return <div>è®¢é˜…ç»„ä»¶</div>;
}

// å®é™…åº”ç”¨ï¼šé˜²æŠ–æœç´¢
function SearchInput() {
  const [query, setQuery] = useState('');
  const [results, setResults] = useState([]);

  useEffect(() => {
    const timer = setTimeout(() => {
      if (query) {
        search(query).then(setResults);
      }
    }, 500);

    return () => clearTimeout(timer);
  }, [query]);

  return (
    <div>
      <input
        value={query}
        onChange={e => setQuery(e.target.value)}
        placeholder="æœç´¢..."
      />
      <ul>
        {results.map(item => (
          <li key={item.id}>{item.name}</li>
        ))}
      </ul>
    </div>
  );
}
```

### 2.4 useContext - è·¨ç»„ä»¶çŠ¶æ€å…±äº«

```jsx
import { createContext, useContext, useState } from 'react';

// åˆ›å»º Context
const ThemeContext = createContext();

// Context Provider ç»„ä»¶
function ThemeProvider({ children }) {
  const [theme, setTheme] = useState('light');

  return (
    <ThemeContext.Provider value={{ theme, setTheme }}>
      {children}
    </ThemeContext.Provider>
  );
}

// è‡ªå®šä¹‰ Hook
function useTheme() {
  const context = useContext(ThemeContext);
  if (!context) {
    throw new Error('useTheme must be used within ThemeProvider');
  }
  return context;
}

// ä½¿ç”¨ Context
function ThemedButton() {
  const { theme, setTheme } = useTheme();

  return (
    <button
      onClick={() => setTheme(theme === 'light' ? 'dark' : 'light')}
      style={{ background: theme === 'light' ? '#fff' : '#333' }}
    >
      åˆ‡æ¢ä¸»é¢˜
    </button>
  );
}

// åº”ç”¨
function App() {
  return (
    <ThemeProvider>
      <ThemedButton />
    </ThemeProvider>
  );
}
```

### 2.5 useReducer - å¤æ‚çŠ¶æ€ç®¡ç†

```jsx
import { useReducer } from 'react';

// å®šä¹‰ reducer
const initialState = { count: 0 };

function reducer(state, action) {
  switch (action.type) {
    case 'increment':
      return { count: state.count + 1 };
    case 'decrement':
      return { count: state.count - 1 };
    case 'reset':
      return initialState;
    default:
      throw new Error('Unknown action');
  }
}

function Counter() {
  const [state, dispatch] = useReducer(reducer, initialState);

  return (
    <div>
      <p>è®¡æ•°: {state.count}</p>
      <button onClick={() => dispatch({ type: 'increment' })}>
        å¢åŠ 
      </button>
      <button onClick={() => dispatch({ type: 'decrement' })}>
        å‡å°‘
      </button>
      <button onClick={() => dispatch({ type: 'reset' })}>
        é‡ç½®
      </button>
    </div>
  );
}

// å¤æ‚åœºæ™¯ï¼šè¡¨å•ç®¡ç†
function formReducer(state, action) {
  switch (action.type) {
    case 'field-change':
      return {
        ...state,
        [action.field]: action.value
      };
    case 'submit':
      return {
        ...state,
        isSubmitting: true
      };
    case 'success':
      return {
        ...state,
        isSubmitting: false,
        submitted: true
      };
    case 'error':
      return {
        ...state,
        isSubmitting: false,
        error: action.error
      };
    default:
      return state;
  }
}

function LoginForm() {
  const [state, dispatch] = useReducer(formReducer, {
    username: '',
    password: '',
    isSubmitting: false,
    error: null,
    submitted: false
  });

  const handleSubmit = async (e) => {
    e.preventDefault();
    dispatch({ type: 'submit' });

    try {
      await login(state.username, state.password);
      dispatch({ type: 'success' });
    } catch (error) {
      dispatch({ type: 'error', error });
    }
  };

  return (
    <form onSubmit={handleSubmit}>
      <input
        type="text"
        value={state.username}
        onChange={e =>
          dispatch({
            type: 'field-change',
            field: 'username',
            value: e.target.value
          })
        }
      />
      <input
        type="password"
        value={state.password}
        onChange={e =>
          dispatch({
            type: 'field-change',
            field: 'password',
            value: e.target.value
          })
        }
      />
      <button type="submit" disabled={state.isSubmitting}>
        {state.isSubmitting ? 'ç™»å½•ä¸­...' : 'ç™»å½•'}
      </button>
      {state.error && <div>{state.error.message}</div>}
    </form>
  );
}
```

### 2.6 useRef - å¼•ç”¨ä¸ DOM æ“ä½œ

```jsx
import { useRef, useEffect } from 'react';

// è®¿é—® DOM å…ƒç´ 
function TextInput() {
  const inputRef = useRef(null);

  useEffect(() => {
    // ç»„ä»¶æŒ‚è½½åè‡ªåŠ¨èšç„¦
    inputRef.current.focus();
  }, []);

  return <input ref={inputRef} type="text" />;
}

// ä¿å­˜å¯å˜å€¼ï¼ˆä¸è§¦å‘é‡æ¸²æŸ“ï¼‰
function Timer() {
  const timerRef = useRef(null);

  const startTimer = () => {
    timerRef.current = setInterval(() => {
      console.log('Tick');
    }, 1000);
  };

  const stopTimer = () => {
    clearInterval(timerRef.current);
  };

  return (
    <div>
      <button onClick={startTimer}>å¼€å§‹</button>
      <button onClick={stopTimer}>åœæ­¢</button>
    </div>
  );
}

// è·å–ä¸Šä¸€è½®çš„ props æˆ– state
function usePrevious(value) {
  const ref = useRef();

  useEffect(() => {
    ref.current = value;
  }, [value]);

  return ref.current;
}

function Counter() {
  const [count, setCount] = useState(0);
  const prevCount = usePrevious(count);

  return (
    <div>
      <p>å½“å‰: {count}</p>
      <p>ä¸Šæ¬¡: {prevCount}</p>
      <button onClick={() => setCount(count + 1)}>å¢åŠ </button>
    </div>
  );
}
```

### 2.7 useMemo & useCallback - æ€§èƒ½ä¼˜åŒ–

```jsx
import { useState, useMemo, useCallback } from 'react';

// useMemo: ç¼“å­˜è®¡ç®—ç»“æœ
function ExpensiveComponent({ items }) {
  // åªæœ‰ items å˜åŒ–æ—¶æ‰é‡æ–°è®¡ç®—
  const sortedItems = useMemo(() => {
    console.log('æ’åºä¸­...');
    return items.sort((a, b) => a.value - b.value);
  }, [items]);

  return <ul>{sortedItems.map(item => <li key={item.id}>{item.name}</li>)}</ul>;
}

// useCallback: ç¼“å­˜å‡½æ•°å¼•ç”¨
function ParentComponent() {
  const [count, setCount] = useState(0);

  // ä¸ä½¿ç”¨ useCallbackï¼Œæ¯æ¬¡æ¸²æŸ“éƒ½åˆ›å»ºæ–°å‡½æ•°
  const handleClickWithoutMemo = () => {
    console.log('Clicked');
  };

  // ä½¿ç”¨ useCallbackï¼Œåªåœ¨ä¾èµ–å˜åŒ–æ—¶åˆ›å»ºæ–°å‡½æ•°
  const handleClick = useCallback(() => {
    console.log('Clicked');
  }, []); // ç©ºä¾èµ–æ•°ç»„ï¼Œå‡½æ•°æ°¸è¿œä¸ä¼šå˜

  return (
    <div>
      <button onClick={() => setCount(count + 1)}>æ›´æ–°: {count}</button>
      <ChildComponent onClick={handleClick} />
    </div>
  );
}

// å­ç»„ä»¶ç”¨ React.memo ä¼˜åŒ–
const ChildComponent = React.memo(({ onClick }) => {
  console.log('å­ç»„ä»¶æ¸²æŸ“');
  return <button onClick={onClick}>å­ç»„ä»¶æŒ‰é’®</button>;
});

// å®é™…åº”ç”¨ï¼šä¼˜åŒ–åˆ—è¡¨é¡¹
function TodoList({ todos, onToggle }) {
  const renderItem = useCallback(
    (todo) => (
      <TodoItem
        key={todo.id}
        todo={todo}
        onToggle={() => onToggle(todo.id)}
      />
    ),
    [onToggle]
  );

  return <ul>{todos.map(renderItem)}</ul>;
}
```

---

## ä¸‰ã€ç»„ä»¶è®¾è®¡æ¨¡å¼

### 3.1 å—æ§ç»„ä»¶ä¸éå—æ§ç»„ä»¶

```jsx
// å—æ§ç»„ä»¶ï¼ˆæ¨èï¼‰
function ControlledForm() {
  const [name, setName] = useState('');
  const [email, setEmail] = useState('');

  const handleSubmit = (e) => {
    e.preventDefault();
    console.log({ name, email });
  };

  return (
    <form onSubmit={handleSubmit}>
      <input
        type="text"
        value={name}
        onChange={e => setName(e.target.value)}
      />
      <input
        type="email"
        value={email}
        onChange={e => setEmail(e.target.value)}
      />
      <button type="submit">æäº¤</button>
    </form>
  );
}

// éå—æ§ç»„ä»¶
function UncontrolledForm() {
  const nameRef = useRef();
  const emailRef = useRef();

  const handleSubmit = (e) => {
    e.preventDefault();
    console.log({
      name: nameRef.current.value,
      email: emailRef.current.value
    });
  };

  return (
    <form onSubmit={handleSubmit}>
      <input
        type="text"
        ref={nameRef}
        defaultValue="å¼ ä¸‰"
      />
      <input
        type="email"
        ref={emailRef}
      />
      <button type="submit">æäº¤</button>
    </form>
  );
}
```

### 3.2 ç»„åˆæ¨¡å¼

```jsx
// çµæ´»çš„ç»„ä»¶ç»„åˆ
function Card({ children, header, footer }) {
  return (
    <div className="card">
      {header && <div className="card-header">{header}</div>}
      <div className="card-body">{children}</div>
      {footer && <div className="card-footer">{footer}</div>}
    </div>
  );
}

// ä½¿ç”¨
function App() {
  return (
    <Card
      header={<h2>æ ‡é¢˜</h2>}
      footer={<button>ç¡®å®š</button>}
    >
      <p>å¡ç‰‡å†…å®¹</p>
    </Card>
  );
}

// æ›´çµæ´»çš„æ–¹å¼ï¼šchildren ä½œä¸ºå‡½æ•°
function List({ items, children }) {
  return (
    <ul>
      {items.map((item, index) => (
        <li key={index}>
          {children(item, index)}
        </li>
      ))}
    </ul>
  );
}

// ä½¿ç”¨
function App() {
  const items = [
    { id: 1, name: 'å¼ ä¸‰', age: 25 },
    { id: 2, name: 'æå››', age: 30 }
  ];

  return (
    <List items={items}>
      {(item, index) => (
        <div>
          <strong>{index + 1}.</strong> {item.name} - {item.age}å²
        </div>
      )}
    </List>
  );
}
```

### 3.3 é«˜é˜¶ç»„ä»¶ï¼ˆHOCï¼‰

```jsx
// HOC: æ·»åŠ æ—¥å¿—åŠŸèƒ½
function withLogger(WrappedComponent) {
  return function EnhancedComponent(props) {
    useEffect(() => {
      console.log('ç»„ä»¶æŒ‚è½½');
      return () => console.log('ç»„ä»¶å¸è½½');
    }, []);

    return <WrappedComponent {...props} />;
  };
}

// ä½¿ç”¨
function MyComponent() {
  return <div>æˆ‘çš„ç»„ä»¶</div>;
}

const LoggedComponent = withLogger(MyComponent);

// HOC: æ·»åŠ åŠ è½½çŠ¶æ€
function withLoading(WrappedComponent) {
  return function LoadingComponent({ isLoading, ...props }) {
    if (isLoading) {
      return <div>åŠ è½½ä¸­...</div>;
    }
    return <WrappedComponent {...props} />;
  };
}

// ä½¿ç”¨
function UserProfile({ user }) {
  return <div>{user.name}</div>;
}

const UserProfileWithLoading = withLoading(UserProfile);

function App() {
  const [user, setUser] = useState(null);
  const [loading, setLoading] = useState(true);

  useEffect(() => {
    fetchUser().then(data => {
      setUser(data);
      setLoading(false);
    });
  }, []);

  return (
    <UserProfileWithLoading
      user={user}
      isLoading={loading}
    />
  );
}
```

### 3.4 è‡ªå®šä¹‰ Hookï¼ˆCustom Hookï¼‰

```jsx
// æŠ½å–é€»è¾‘ä¸ºå¯å¤ç”¨çš„ Hook
function useWindowSize() {
  const [size, setSize] = useState({
    width: window.innerWidth,
    height: window.innerHeight
  });

  useEffect(() => {
    const handleResize = () => {
      setSize({
        width: window.innerWidth,
        height: window.innerHeight
      });
    };

    window.addEventListener('resize', handleResize);
    return () => window.removeEventListener('resize', handleResize);
  }, []);

  return size;
}

// ä½¿ç”¨
function ResponsiveComponent() {
  const { width, height } = useWindowSize();

  return (
    <div>
      çª—å£å¤§å°: {width} x {height}
    </div>
  );
}

// æ•°æ®è·å– Hook
function useFetch(url) {
  const [data, setData] = useState(null);
  const [loading, setLoading] = useState(true);
  const [error, setError] = useState(null);

  useEffect(() => {
    const fetchData = async () => {
      try {
        const response = await fetch(url);
        const json = await response.json();
        setData(json);
      } catch (err) {
        setError(err);
      } finally {
        setLoading(false);
      }
    };

    fetchData();
  }, [url]);

  return { data, loading, error };
}

// è¡¨å• Hook
function useForm(initialValues, onSubmit) {
  const [values, setValues] = useState(initialValues);

  const handleChange = (e) => {
    const { name, value } = e.target;
    setValues({
      ...values,
      [name]: value
    });
  };

  const handleSubmit = (e) => {
    e.preventDefault();
    onSubmit(values);
  };

  return { values, handleChange, handleSubmit };
}

// ä½¿ç”¨è¡¨å• Hook
function LoginForm() {
  const { values, handleChange, handleSubmit } = useForm(
    { username: '', password: '' },
    (data) => {
      console.log('æäº¤:', data);
    }
  );

  return (
    <form onSubmit={handleSubmit}>
      <input
        name="username"
        value={values.username}
        onChange={handleChange}
      />
      <input
        name="password"
        type="password"
        value={values.password}
        onChange={handleChange}
      />
      <button type="submit">ç™»å½•</button>
    </form>
  );
}
```

---

## å››ã€React æ€§èƒ½ä¼˜åŒ–

### 4.1 é¿å…ä¸å¿…è¦çš„é‡æ¸²æŸ“

```jsx
// React.memo: è®°å¿†ç»„ä»¶
const ExpensiveComponent = React.memo(({ data }) => {
  console.log('æ¸²æŸ“');
  return <div>{data}</div>;
});

// æŒ‡å®šæ¯”è¾ƒå‡½æ•°
const CustomMemoComponent = React.memo(
  ({ data, onUpdate }) => {
    return <div onClick={onUpdate}>{data}</div>;
  },
  (prevProps, nextProps) => {
    // è¿”å› true è¡¨ç¤º props ç›¸ç­‰ï¼Œä¸éœ€è¦é‡æ–°æ¸²æŸ“
    return prevProps.data === nextProps.data;
  }
);

// useMemo: ç¼“å­˜è®¡ç®—ç»“æœ
function ParentComponent({ items }) {
  const expensiveValue = useMemo(() => {
    return items.reduce((sum, item) => sum + item.value, 0);
  }, [items]);

  return <ChildComponent value={expensiveValue} />;
}

// useCallback: ç¼“å­˜å‡½æ•°
function ParentComponent() {
  const [count, setCount] = useState(0);

  const handleClick = useCallback(() => {
    setCount(c => c + 1);
  }, []); // ä¾èµ–ä¸ºç©ºï¼Œå‡½æ•°å¼•ç”¨ä¸å˜

  return <ChildComponent onClick={handleClick} />;
}
```

### 4.2 è™šæ‹ŸåŒ–é•¿åˆ—è¡¨

```jsx
// ä½¿ç”¨ react-window è™šæ‹Ÿæ»šåŠ¨
import { FixedSizeList } from 'react-window';

function VirtualizedList({ items }) {
  const Row = ({ index, style }) => (
    <div style={style}>
      {items[index].name}
    </div>
  );

  return (
    <FixedSizeList
      height={400}
      width="100%"
      itemSize={50}
      itemCount={items.length}
    >
      {Row}
    </FixedSizeList>
  );
}
```

### 4.3 ä»£ç åˆ†å‰²

```jsx
import { lazy, Suspense } from 'react';

// è·¯ç”±çº§ä»£ç åˆ†å‰²
const Home = lazy(() => import('./routes/Home'));
const About = lazy(() => import('./routes/About'));

function App() {
  return (
    <Suspense fallback={<div>åŠ è½½ä¸­...</div>}>
      <Routes>
        <Route path="/" element={<Home />} />
        <Route path="/about" element={<About />} />
      </Routes>
    </Suspense>
  );
}

// ç»„ä»¶çº§ä»£ç åˆ†å‰²
function Dashboard() {
  const [showChart, setShowChart] = useState(false);

  const Chart = lazy(() => import('./Chart'));

  return (
    <div>
      <button onClick={() => setShowChart(true)}>
        æ˜¾ç¤ºå›¾è¡¨
      </button>
      {showChart && (
        <Suspense fallback={<div>åŠ è½½å›¾è¡¨...</div>}>
          <Chart />
        </Suspense>
      )}
    </div>
  );
}
```

---

## äº”ã€React å¼€å‘æœ€ä½³å®è·µ

### 5.1 ç»„ä»¶è®¾è®¡åŸåˆ™

```jsx
// âœ… å•ä¸€èŒè´£
function UserAvatar({ src, alt }) {
  return <img src={src} alt={alt} className="avatar" />;
}

function UserCard({ user }) {
  return (
    <div className="card">
      <UserAvatar src={user.avatar} alt={user.name} />
      <h3>{user.name}</h3>
      <p>{user.bio}</p>
    </div>
  );
}

// âŒ èŒè´£ä¸æ¸…
function UserComponent({ user }) {
  // æ—¢å¤„ç†å¤´åƒï¼Œåˆå¤„ç†å¡ç‰‡ï¼Œè¿˜å¤„ç†æ•°æ®è·å–
  const [data, setData] = useState(null);
  useEffect(() => {
    fetchUser().then(setData);
  }, []);

  return (
    <div>
      <img src={data?.avatar} />
      <div className="card">{data?.name}</div>
    </div>
  );
}
```

### 5.2 Props è®¾è®¡

```jsx
// âœ… ä½¿ç”¨è§£æ„å’Œé»˜è®¤å€¼
function Button({
  children,
  variant = 'primary',
  size = 'medium',
  disabled = false,
  onClick
}) {
  return (
    <button
      className={`btn btn-${variant} btn-${size}`}
      disabled={disabled}
      onClick={onClick}
    >
      {children}
    </button>
  );
}

// âœ… ä½¿ç”¨ TypeScript æ¥å£
interface ButtonProps {
  children: React.ReactNode;
  variant?: 'primary' | 'secondary' | 'danger';
  size?: 'small' | 'medium' | 'large';
  disabled?: boolean;
  onClick?: () => void;
}

function Button({ children, ...props }: ButtonProps) {
  return <button {...props}>{children}</button>;
}
```

### 5.3 é”™è¯¯è¾¹ç•Œ

```jsx
class ErrorBoundary extends React.Component {
  constructor(props) {
    super(props);
    this.state = { hasError: false, error: null };
  }

  static getDerivedStateFromError(error) {
    return { hasError: true, error };
  }

  componentDidCatch(error, errorInfo) {
    console.error('é”™è¯¯è¾¹ç•Œæ•è·:', error, errorInfo);
  }

  render() {
    if (this.state.hasError) {
      return (
        <div>
          <h1>å‡ºé”™äº†!</h1>
          <p>{this.state.error?.message}</p>
        </div>
      );
    }

    return this.props.children;
  }
}

// ä½¿ç”¨
function App() {
  return (
    <ErrorBoundary>
      <MyComponent />
    </ErrorBoundary>
  );
}
```

---

## å…­ã€å¸¸è§é—®é¢˜ä¸é¿å‘æŒ‡å—

### âŒ é—®é¢˜ 1ï¼šåœ¨å¾ªç¯ã€æ¡ä»¶æˆ–åµŒå¥—å‡½æ•°ä¸­è°ƒç”¨ Hook

```jsx
// âŒ é”™è¯¯
function BadComponent({ condition }) {
  if (condition) {
    const [state, setState] = useState(0); // è¿åè§„åˆ™
  }

  items.forEach(item => {
    useEffect(() => {}, [item]); // è¿åè§„åˆ™
  });
}

// âœ… æ­£ç¡®
function GoodComponent({ condition }) {
  const [state, setState] = useState(0);

  if (condition) {
    // å¯ä»¥ä½¿ç”¨ state
  }

  useEffect(() => {
    // å¯ä»¥ä½¿ç”¨ items
  }, [items]);
}
```

### âŒ é—®é¢˜ 2ï¼šé—­åŒ…é™·é˜±

```jsx
// âŒ é—®é¢˜ï¼šæ€»æ˜¯ä½¿ç”¨åˆå§‹å€¼
function Counter() {
  const [count, setCount] = useState(0);

  useEffect(() => {
    const timer = setInterval(() => {
      console.log(count); // æ€»æ˜¯æ‰“å° 0
    }, 1000);

    return () => clearInterval(timer);
  }, []); // ä¾èµ–ä¸ºç©º

  return <div>{count}</div>;
}

// âœ… æ–¹æ¡ˆ 1ï¼šæ·»åŠ ä¾èµ–
useEffect(() => {
  const timer = setInterval(() => {
    console.log(count);
  }, 1000);
  return () => clearInterval(timer);
}, [count]);

// âœ… æ–¹æ¡ˆ 2ï¼šä½¿ç”¨å‡½æ•°å¼æ›´æ–°
useEffect(() => {
  const timer = setInterval(() => {
    setCount(prev => prev + 1);
  }, 1000);
  return () => clearInterval(timer);
}, []);
```

### âŒ é—®é¢˜ 3ï¼šç›´æ¥ä¿®æ”¹ state

```jsx
// âŒ ç›´æ¥ä¿®æ”¹
function BadComponent() {
  const [items, setItems] = useState([1, 2, 3]);

  const addItem = () => {
    items.push(4); // ç›´æ¥ä¿®æ”¹
    setItems(items);
  };

  return <button onClick={addItem}>æ·»åŠ </button>;
}

// âœ… åˆ›å»ºæ–°æ•°ç»„
function GoodComponent() {
  const [items, setItems] = useState([1, 2, 3]);

  const addItem = () => {
    setItems([...items, 4]);
  };

  return <button onClick={addItem}>æ·»åŠ </button>;
}
```

---

## ä¸ƒã€æ€»ç»“ä¸è®°å¿†è¦ç‚¹

### ğŸ¯ æ ¸å¿ƒè®°å¿†å£è¯€

```
ç»„ä»¶åŒ–è®¾è®¡é‡èŒè´£
Hooks å¸¦æ¥æ–°ä½“éªŒ
useState ç®¡ç†ç»„ä»¶çŠ¶æ€
useEffect å¤„ç†å‰¯ä½œç”¨
useContext è·¨ç»„ä»¶å…±äº«
useReducer ç®¡ç†å¤æ‚çŠ¶æ€
useRef æ“ä½œ DOM å…ƒç´ 
useMemo ç¼“å­˜è®¡ç®—ç»“æœ
useCallback ä¼˜åŒ–å‡½æ•°å¼•ç”¨
ç»„åˆä¼˜äºç»§æ‰¿
è‡ªå®šä¹‰ Hook å¤ç”¨é€»è¾‘
æ€§èƒ½ä¼˜åŒ–è®°å¿ƒä¸Š
```

### ğŸ“š å…³é”®æŠ€æœ¯ç‚¹

1. **ç»„ä»¶ç±»å‹**ï¼šå‡½æ•°ç»„ä»¶ã€ç±»ç»„ä»¶ï¼ˆä¸æ¨èï¼‰
2. **Hooks è§„åˆ™**ï¼šåªèƒ½åœ¨é¡¶å±‚è°ƒç”¨ã€åªèƒ½åœ¨ React å‡½æ•°ä¸­è°ƒç”¨
3. **å¸¸ç”¨ Hooks**ï¼šuseStateã€useEffectã€useContextã€useReducer
4. **æ€§èƒ½ä¼˜åŒ–**ï¼šReact.memoã€useMemoã€useCallback
5. **è®¾è®¡æ¨¡å¼**ï¼šç»„åˆã€HOCã€è‡ªå®šä¹‰ Hook
6. **æœ€ä½³å®è·µ**ï¼šå•ä¸€èŒè´£ã€Props è®¾è®¡ã€é”™è¯¯è¾¹ç•Œ

---

## å…«ã€å®æˆ˜ç»ƒä¹ å»ºè®®

1. å®ç°ä¸€ä¸ªå®Œæ•´çš„ TODO åº”ç”¨ï¼ˆCRUD + çŠ¶æ€ç®¡ç†ï¼‰
2. åˆ›å»ºè‡ªå®šä¹‰ Hook å®ç° debounceã€throttleã€localStorage
3. ç”¨ Context + useReducer å®ç°å…¨å±€çŠ¶æ€ç®¡ç†
4. å®ç°ä¸€ä¸ªè™šæ‹Ÿæ»šåŠ¨åˆ—è¡¨ç»„ä»¶
5. ç”¨ React.lazy + Suspense ä¼˜åŒ–è·¯ç”±åŠ è½½

---

**ä¸‹ä¸€æ­¥å­¦ä¹ **ï¼šğŸ‘‰ [React çŠ¶æ€ç®¡ç†](./çŠ¶æ€ç®¡ç†.md)
