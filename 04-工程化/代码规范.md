# ä»£ç è§„èŒƒ

## ä¸€ã€ESLintï¼ˆä»£ç è´¨é‡ï¼‰

### 1.1 åŸºç¡€é…ç½®

```bash
# å®‰è£… ESLint
npm install -D eslint

# åˆå§‹åŒ–é…ç½®
npx eslint --init

# æˆ–ä½¿ç”¨ TypeScript
npx eslint --init -- --parser-options-project=tsconfig.json
```

```javascript
// .eslintrc.jsï¼ˆæ¨èä½¿ç”¨ .js é…ç½®æ–‡ä»¶ï¼‰
module.exports = {
  // è¿è¡Œç¯å¢ƒ
  env: {
    browser: true,
    node: true,
    es2021: true,
    jest: true
  },

  // ç»§æ‰¿é…ç½®
  extends: [
    'eslint:recommended',              // ESLint å†…ç½®è§„åˆ™
    'plugin:@typescript-eslint/recommended',  // TypeScript è§„åˆ™
    'plugin:react/recommended',        // React è§„åˆ™
    'plugin:react-hooks/recommended',  // React Hooks è§„åˆ™
    'plugin:jsx-a11y/recommended',     // å¯è®¿é—®æ€§è§„åˆ™
    'prettier'                         // å…³é—­ä¸ Prettier å†²çªçš„è§„åˆ™
  ],

  // è§£æå™¨
  parser: '@typescript-eslint/parser',

  // è§£æå™¨é€‰é¡¹
  parserOptions: {
    ecmaVersion: 'latest',
    sourceType: 'module',
    ecmaFeatures: {
      jsx: true
    },
    project: './tsconfig.json'         // TypeScript é¡¹ç›®è·¯å¾„
  },

  // æ’ä»¶
  plugins: [
    '@typescript-eslint',
    'react',
    'react-hooks',
    'jsx-a11y',
    'import'
  ],

  // è§„åˆ™é…ç½®
  rules: {
    // TypeScript è§„åˆ™
    '@typescript-eslint/no-unused-vars': ['warn', { argsIgnorePattern: '^_' }],
    '@typescript-eslint/no-explicit-any': 'warn',
    '@typescript-eslint/explicit-function-return-type': 'off',
    '@typescript-eslint/explicit-module-boundary-types': 'off',

    // React è§„åˆ™
    'react/react-in-jsx-scope': 'off',  // React 17+ ä¸éœ€è¦å¯¼å…¥ React
    'react/prop-types': 'off',          // ä½¿ç”¨ TypeScriptï¼Œä¸éœ€è¦ prop-types
    'react-hooks/rules-of-hooks': 'error',
    'react-hooks/exhaustive-deps': 'warn',

    // é€šç”¨è§„åˆ™
    'no-console': ['warn', { allow: ['warn', 'error'] }],
    'no-debugger': 'error',
    'no-var': 'error',
    'prefer-const': 'error',
    'eqeqeq': ['error', 'always'],     // å¼ºåˆ¶ä½¿ç”¨ ===
    'curly': ['error', 'all'],          // å¼ºåˆ¶ä½¿ç”¨å¤§æ‹¬å·

    // Import è§„åˆ™
    'import/order': [
      'error',
      {
        groups: [
          'builtin',    // Node.js å†…ç½®æ¨¡å—
          'external',   // npm åŒ…
          'internal',   // å†…éƒ¨æ¨¡å—
          'parent',     // çˆ¶çº§ç›®å½•
          'sibling',    // åŒçº§ç›®å½•
          'index'       // å½“å‰ç›®å½• index
        ],
        'newlines-between': 'never',
        alphabetize: { order: 'asc' }
      }
    ]
  },

  // è®¾ç½®
  settings: {
    react: {
      version: 'detect'                 // è‡ªåŠ¨æ£€æµ‹ React ç‰ˆæœ¬
    },
    'import/resolver': {
      typescript: {},
      alias: {
        map: [['@', './src']],
        extensions: ['.js', '.jsx', '.ts', '.tsx']
      }
    }
  }
};
```

### 1.2 å‘½ä»¤è¡Œä½¿ç”¨

```bash
# æ£€æŸ¥æ–‡ä»¶
npx eslint src/

# ä¿®å¤é—®é¢˜
npx eslint src/ --fix

# æ£€æŸ¥ç‰¹å®šæ–‡ä»¶
npx eslint src/App.tsx

# ä½¿ç”¨ç¼“å­˜ï¼ˆåŠ é€Ÿï¼‰
npx eslint src/ --cache

# è¾“å‡ºæ ¼å¼
npx eslint src/ -f json > report.json
npx eslint src/ -f html > report.html

# é…åˆ Prettier
npx eslint src/ --fix && npx prettier src/ --write
```

### 1.3 ESLint å¿½ç•¥æ–‡ä»¶

```
# .eslintignore
node_modules/
dist/
build/
coverage/
*.min.js
*.config.js
```

---

## äºŒã€Prettierï¼ˆä»£ç æ ¼å¼åŒ–ï¼‰

### 2.1 åŸºç¡€é…ç½®

```bash
# å®‰è£… Prettier
npm install -D prettier

# å®‰è£… ESLint é›†æˆ
npm install -D eslint-config-prettier eslint-plugin-prettier
```

```javascript
// .prettierrc.js æˆ– .prettierrc
module.exports = {
  // å•è¡Œé•¿åº¦
  printWidth: 80,

  // ç¼©è¿›ç©ºæ ¼æ•°
  tabWidth: 2,

  // ä½¿ç”¨ç©ºæ ¼ç¼©è¿›
  useTabs: false,

  // è¯­å¥æœ«å°¾åŠ åˆ†å·
  semi: true,

  // ä½¿ç”¨å•å¼•å·
  singleQuote: true,

  // å¯¹è±¡å±æ€§å¼•å·
  quoteProps: 'as-needed',

  // JSX ä½¿ç”¨å•å¼•å·
  jsxSingleQuote: false,

  // å°¾éšé€—å·
  trailingComma: 'es5',

  // å¯¹è±¡å¤§æ‹¬å·å†…éƒ¨ç©ºæ ¼
  bracketSpacing: true,

  // å¤šè¡Œ HTML å…ƒç´  > å•ç‹¬ä¸€è¡Œ
  bracketSameLine: false,

  // ç®­å¤´å‡½æ•°å‚æ•°æ‹¬å·
  arrowParens: 'always',

  // æ¢è¡Œç¬¦
  endOfLine: 'lf',

  // æ ¼å¼åŒ–èŒƒå›´ï¼ˆä»…æ ¼å¼åŒ–ä¿®æ”¹çš„æ–‡ä»¶ï¼‰
  rangeStart: 0,
  rangeEnd: Infinity
};
```

### 2.2 ä½¿ç”¨æ–¹å¼

```bash
# æ£€æŸ¥æ ¼å¼
npx prettier --check src/

# æ ¼å¼åŒ–æ–‡ä»¶
npx prettier --write src/

# æ ¼å¼åŒ–ç‰¹å®šæ–‡ä»¶
npx prettier --write src/App.tsx

# ä½¿ç”¨é…ç½®æ–‡ä»¶
npx prettier --write src/ --config .prettierrc.js

# é…åˆ Git
npx pretty-quick --staged
```

### 2.3 Prettier å¿½ç•¥æ–‡ä»¶

```
# .prettierignore
node_modules/
dist/
build/
coverage/
package-lock.json
pnpm-lock.yaml
*.min.js
*.config.js
```

### 2.4 ç¼–è¾‘å™¨é…ç½®

```json
// .vscode/settings.json
{
  "editor.formatOnSave": true,
  "editor.defaultFormatter": "esbenp.prettier-vscode",
  "editor.codeActionsOnSave": {
    "source.fixAll.eslint": true
  },
  "[javascript]": {
    "editor.defaultFormatter": "esbenp.prettier-vscode"
  },
  "[typescript]": {
    "editor.defaultFormatter": "esbenp.prettier-vscode"
  },
  "[json]": {
    "editor.defaultFormatter": "esbenp.prettier-vscode"
  }
}
```

---

## ä¸‰ã€Stylelintï¼ˆCSS è§„èŒƒï¼‰

### 3.1 åŸºç¡€é…ç½®

```bash
# å®‰è£… Stylelint
npm install -D stylelint stylelint-config-standard

# æ”¯æŒ SCSS
npm install -D stylelint-scss

# æ”¯æŒ CSS-in-JS
npm install -D stylelint-config-styled-components
```

```javascript
// .stylelintrc.js
module.exports = {
  extends: [
    'stylelint-config-standard',
    'stylelint-config-standard-scss'  // SCSS é¡¹ç›®
  ],

  plugins: ['stylelint-scss'],

  rules: {
    // ç¼©è¿›
    'indentation': 2,

    // å­—ç¬¦ä¸²å¼•å·
    'string-quotes': 'single',

    // é¢œè‰²æ ¼å¼
    'color-hex-case': 'lower',
    'color-hex-length': 'short',

    // é€‰æ‹©å™¨
    'selector-class-pattern': '^[a-z][a-z0-9-]*$',
    'selector-id-pattern': '^[a-z][a-z0-9-]*$',

    // å±æ€§é¡ºåº
    'declaration-block-order': 'alphabetical',

    // ç¦æ­¢ !important
    'declaration-no-important': true,

    // ç¦æ­¢ä½ä¼˜å…ˆçº§é€‰æ‹©å™¨
    'selector-max-id': 0,

    // SCSS è§„åˆ™
    'scss/at-mixin-pattern': '^[a-z][a-z0-9-]*$',
    'scss/at-function-pattern': '^[a-z][a-z0-9-]*$',
    'scss/dollar-variable-pattern': '^[a-z][a-z0-9-]*$',

    // ç¦æ­¢æœªä½¿ç”¨çš„ç±»
    'selector-class-pattern': null
  },

  overrides: [
    {
      files: ['**/*.scss'],
      rules: {
        'at-rule-no-unknown': null,
        'scss/at-rule-no-unknown': true
      }
    }
  ]
};
```

### 3.2 ä½¿ç”¨æ–¹å¼

```bash
# æ£€æŸ¥
npx stylelint "src/**/*.css"

# ä¿®å¤
npx stylelint "src/**/*.css" --fix

# SCSS
npx stylelint "src/**/*.scss" --fix
```

---

## å››ã€Commit è§„èŒƒ

### 4.1 Commitlint

```bash
# å®‰è£…
npm install -D @commitlint/cli @commitlint/config-conventional

# é…åˆ Husky
npm install -D husky
npx husky-init
```

```javascript
// commitlint.config.js
module.exports = {
  extends: ['@commitlint/config-conventional'],
  rules: {
    // ç±»å‹æšä¸¾
    'type-enum': [
      2,
      'always',
      [
        'feat',     // æ–°åŠŸèƒ½
        'fix',      // ä¿®å¤ bug
        'docs',     // æ–‡æ¡£
        'style',    // æ ¼å¼
        'refactor', // é‡æ„
        'perf',     // æ€§èƒ½ä¼˜åŒ–
        'test',     // æµ‹è¯•
        'chore',    // æ„å»ºè¿‡ç¨‹æˆ–è¾…åŠ©å·¥å…·
        'revert',   // å›æ»š
        'ci'        // CI é…ç½®
      ]
    ],
    // ç±»å‹å°å†™
    'type-case': [2, 'always', 'lower-case'],
    // ç±»å‹ä¸èƒ½ä¸ºç©º
    'type-empty': [2, 'never'],
    // æè¿°ä¸èƒ½ä¸ºç©º
    'subject-empty': [2, 'never'],
    // æè¿°ç»“å°¾ä¸èƒ½æœ‰å¥å·
    'subject-full-stop': [2, 'never', '.'],
    // æè¿°é•¿åº¦
    'subject-max-length': [2, 'always', 100]
  }
};
```

```bash
# é…ç½® Husky
# .husky/commit-msg
#!/bin/sh
. "$(dirname "$0")/_/husky.sh"

npx --no -- commitlint --edit $1
```

### 4.2 Commit æ ¼å¼

```
<type>(<scope>): <subject>

<body>

<footer>
```

**ç¤ºä¾‹**
```
feat(auth): add user login feature

- Add login form component
- Implement JWT authentication
- Add error handling

Closes #123
```

**å¸¸ç”¨ç±»å‹**
- `feat`: æ–°åŠŸèƒ½
- `fix`: ä¿®å¤ bug
- `docs`: æ–‡æ¡£æ›´æ–°
- `style`: ä»£ç æ ¼å¼ï¼ˆä¸å½±å“åŠŸèƒ½ï¼‰
- `refactor`: é‡æ„ï¼ˆæ—¢ä¸æ˜¯æ–°åŠŸèƒ½ä¹Ÿä¸æ˜¯ä¿®å¤ï¼‰
- `perf`: æ€§èƒ½ä¼˜åŒ–
- `test`: æ·»åŠ æˆ–æ›´æ–°æµ‹è¯•
- `chore`: æ„å»ºè¿‡ç¨‹æˆ–è¾…åŠ©å·¥å…·å˜åŠ¨

---

## äº”ã€Husky + Lint-stagedï¼ˆGit Hooksï¼‰

### 5.1 é…ç½®

```bash
# å®‰è£…
npm install -D husky lint-staged

# åˆå§‹åŒ–
npx husky-init

# æˆ–æ‰‹åŠ¨é…ç½®
npx husky install
npm pkg set scripts.prepare="husky install"
```

### 5.2 lint-staged é…ç½®

```json
// package.json
{
  "lint-staged": {
    "*.{js,jsx,ts,tsx}": [
      "eslint --fix",
      "prettier --write"
    ],
    "*.{css,scss}": [
      "stylelint --fix",
      "prettier --write"
    ],
    "*.{json,md}": [
      "prettier --write"
    ],
    "*.{ts,tsx}": [
      "tsc --noEmit"  // TypeScript ç±»å‹æ£€æŸ¥
    ]
  }
}
```

### 5.3 Husky Hooks

```bash
# .husky/pre-commit
#!/bin/sh
. "$(dirname "$0")/_/husky.sh"

npx lint-staged

# .husky/commit-msg
#!/bin/sh
. "$(dirname "$0")/_/husky.sh"

npx commitlint --edit $1
```

---

## å…­ã€TypeScript é…ç½®

### 6.1 tsconfig.json

```json
{
  "compilerOptions": {
    // è¯­è¨€ä¸ç¯å¢ƒ
    "target": "ES2020",
    "lib": ["ES2020", "DOM", "DOM.Iterable"],
    "jsx": "react-jsx",

    // æ¨¡å—
    "module": "ESNext",
    "moduleResolution": "node",
    "resolveJsonModule": true,
    "allowSyntheticDefaultImports": true,
    "esModuleInterop": true,

    // ç±»å‹æ£€æŸ¥
    "strict": true,
    "noUnusedLocals": true,
    "noUnusedParameters": true,
    "noFallthroughCasesInSwitch": true,
    "noImplicitReturns": true,
    "noUncheckedIndexedAccess": true,

    // å…¶ä»–
    "skipLibCheck": true,
    "forceConsistentCasingInFileNames": true,
    "isolatedModules": true,
    "allowImportingTsExtensions": true,

    // è·¯å¾„æ˜ å°„
    "baseUrl": ".",
    "paths": {
      "@/*": ["src/*"],
      "@components/*": ["src/components/*"],
      "@utils/*": ["src/utils/*"]
    }
  },

  "include": [
    "src",
    "vite.config.ts"
  ],

  "exclude": [
    "node_modules",
    "dist",
    "build"
  ]
}
```

---

## ä¸ƒã€æœ€ä½³å®è·µ

### 7.1 ç»Ÿä¸€ç¼–ç é£æ ¼

```bash
# EditorConfigï¼ˆç¼–è¾‘å™¨é…ç½®ï¼‰
# .editorconfig
root = true

[*]
charset = utf-8
indent_style = space
indent_size = 2
end_of_line = lf
insert_final_newline = true
trim_trailing_whitespace = true

[*.md]
trim_trailing_whitespace = false
```

### 7.2 å›¢é˜Ÿåä½œè§„èŒƒ

```javascript
// npm scripts
{
  "scripts": {
    "lint": "eslint .",
    "lint:fix": "eslint . --fix",
    "format": "prettier --write .",
    "type-check": "tsc --noEmit",
    "check": "npm run lint && npm run type-check"
  }
}

// CI/CD é›†æˆ
// .github/workflows/lint.yml
name: Lint

on: [push, pull_request]

jobs:
  lint:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v3
      - uses: actions/setup-node@v3
        with:
          node-version: 18
      - run: npm ci
      - run: npm run lint
      - run: npm run type-check
```

---

## å…«ã€å¸¸è§é—®é¢˜ä¸é¿å‘æŒ‡å—

### âŒ é—®é¢˜ 1ï¼šESLint å’Œ Prettier å†²çª

```javascript
// âœ… è§£å†³æ–¹æ¡ˆï¼šä½¿ç”¨ eslint-config-prettier
// .eslintrc.js
module.exports = {
  extends: [
    // ...å…¶ä»–é…ç½®
    'prettier'  // å¿…é¡»æ”¾åœ¨æœ€å
  ]
};
```

### âŒ é—®é¢˜ 2ï¼šLint æ£€æŸ¥å¤ªæ…¢

```bash
# âœ… ä½¿ç”¨ lint-staged åªæ£€æŸ¥æš‚å­˜æ–‡ä»¶
# âœ… ä½¿ç”¨ç¼“å­˜
npx eslint src/ --cache

# âœ… å¹¶è¡Œæ£€æŸ¥
npx eslint src/ --cache --cache-location=node_modules/.cache/eslint
```

### âŒ é—®é¢˜ 3ï¼šå›¢é˜Ÿé…ç½®ä¸ä¸€è‡´

```bash
# âœ… ä½¿ç”¨ç»Ÿä¸€çš„é…ç½®åŒ…
# åˆ›å»ºç‹¬ç«‹çš„é…ç½®åŒ…
# eslint-config-my-team

# å®‰è£…
npm install -D eslint-config-my-team

# ä½¿ç”¨
module.exports = {
  extends: ['my-team']
};
```

---

## ä¹ã€æ€»ç»“ä¸è®°å¿†è¦ç‚¹

### ğŸ¯ æ ¸å¿ƒè®°å¿†å£è¯€

```
ESLint æŸ¥ä»£ç è´¨é‡
Prettier ç®¡ä»£ç æ ¼å¼
Stylelint è§„èŒƒæ ·å¼
Commitlint è§„èŒƒæäº¤
Husky è‡ªåŠ¨æ‰§è¡Œ
Lint-staged ä»…æ£€æŸ¥æš‚å­˜
TypeScript ç±»å‹æ£€æŸ¥
ç»Ÿä¸€é…ç½®ä¿ä¸€è‡´
```

### ğŸ“š å…³é”®æŠ€æœ¯ç‚¹

1. **ESLint**ï¼šä»£ç è´¨é‡ã€æœ€ä½³å®è·µ
2. **Prettier**ï¼šä»£ç æ ¼å¼åŒ–ã€ç»Ÿä¸€é£æ ¼
3. **Stylelint**ï¼šCSS/SCSS è§„èŒƒ
4. **Commitlint**ï¼šGit æäº¤ä¿¡æ¯è§„èŒƒ
5. **Husky**ï¼šGit Hooks è‡ªåŠ¨åŒ–
6. **Lint-staged**ï¼šåªæ£€æŸ¥æš‚å­˜æ–‡ä»¶
7. **EditorConfig**ï¼šç¼–è¾‘å™¨ç»Ÿä¸€é…ç½®

---

## åã€å®æˆ˜ç»ƒä¹ å»ºè®®

1. ä»é›¶é…ç½® ESLint + Prettier
2. é…ç½® Husky + Lint-staged
3. åˆ›å»ºå›¢é˜Ÿç»Ÿä¸€çš„ ESLint é…ç½®åŒ…
4. é›†æˆåˆ° CI/CD æµç¨‹
5. é…ç½® VS Code è‡ªåŠ¨æ ¼å¼åŒ–

---

**ä¸‹ä¸€æ­¥å­¦ä¹ **ï¼šğŸ‘‰ [CI/CD](./CI-CD.md)
