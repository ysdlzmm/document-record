# åŒ…ç®¡ç†å™¨

## ä¸€ã€åŒ…ç®¡ç†å™¨æ¦‚è¿°

### 1.1 å‘å±•å†ç¨‹

```
npm (Node Package Manager)
  â†“
yarn (Facebook, æ›´å¿«ã€æ›´å¯é )
  â†“
pnpm (Performant npm, èŠ‚çœç£ç›˜ç©ºé—´ã€é€Ÿåº¦æ›´å¿«)
```

### 1.2 å¯¹æ¯”è¡¨

| ç‰¹æ€§ | npm | yarn (v1) | yarn (v2+/Berry) | pnpm |
|------|-----|-----------|------------------|------|
| **é€Ÿåº¦** | â­â­â­ | â­â­â­â­ | â­â­â­â­â­ | â­â­â­â­â­ |
| **ç£ç›˜ç©ºé—´** | å¤§ | å¤§ | ä¸­ | å° |
| **å¹½çµä¾èµ–** | âŒ | âŒ | âŒ | âœ… |
| **Monorepo** | æ”¯æŒï¼ˆworkspacesï¼‰ | æ”¯æŒ | åŸç”Ÿæ”¯æŒ | åŸç”Ÿæ”¯æŒ |
| **é”æ–‡ä»¶** | package-lock.json | yarn.lock | yarn.lock | pnpm-lock.yaml |
| **å…¼å®¹æ€§** | æœ€å¥½ | å¥½ | ä¸­ç­‰ | å¥½ |

---

## äºŒã€npmï¼ˆNode Package Managerï¼‰

### 2.1 åŸºç¡€ç”¨æ³•

```bash
# åˆå§‹åŒ–é¡¹ç›®
npm init
npm init -y  # è·³è¿‡æ‰€æœ‰æé—®

# å®‰è£…ä¾èµ–
npm install react           # ç”Ÿäº§ä¾èµ–
npm i react                 # ç®€å†™
npm install -D typescript   # å¼€å‘ä¾èµ–ï¼ˆ--save-devï¼‰
npm install -g yarn         # å…¨å±€å®‰è£…ï¼ˆ--globalï¼‰

# å¸è½½ä¾èµ–
npm uninstall react
npm un react                # ç®€å†™

# æ›´æ–°ä¾èµ–
npm update                  # æ›´æ–°æ‰€æœ‰ä¾èµ–
npm update react            # æ›´æ–°æŒ‡å®šåŒ…
npm outdated                # æŸ¥çœ‹è¿‡æ—¶çš„åŒ…

# è¿è¡Œè„šæœ¬
npm run dev
npm start                   # npm run çš„ç®€å†™
npm test                    # npm run test çš„ç®€å†™

# æŸ¥çœ‹ä¿¡æ¯
npm list                    # æŸ¥çœ‹å·²å®‰è£…çš„åŒ…
npm ls react                # æŸ¥çœ‹ç‰¹å®šåŒ…
npm view react              # æŸ¥çœ‹åŒ…ä¿¡æ¯
npm info react versions     # æŸ¥çœ‹æ‰€æœ‰ç‰ˆæœ¬

# é…ç½®
npm config set registry https://registry.npmmirror.com  # è®¾ç½®é•œåƒ
npm config get registry
npm config delete registry
```

### 2.2 package.json è¯¦è§£

```json
{
  "name": "my-project",
  "version": "1.0.0",
  "description": "My awesome project",
  "main": "dist/index.js",           # å…¥å£æ–‡ä»¶
  "module": "dist/index.esm.js",     # ES Module å…¥å£
  "types": "dist/index.d.ts",        # TypeScript ç±»å‹å®šä¹‰
  "files": [                         # å‘å¸ƒæ—¶åŒ…å«çš„æ–‡ä»¶
    "dist",
    "README.md"
  ],
  "bin": {                           # å‘½ä»¤è¡Œå·¥å…·
    "my-cli": "./bin/cli.js"
  },
  "scripts": {
    "dev": "vite",
    "build": "vite build",
    "preview": "vite preview",
    "lint": "eslint .",
    "format": "prettier --write .",
    "test": "vitest",
    "prepublishOnly": "npm run build" # å‘å¸ƒå‰æ‰§è¡Œ
  },
  "dependencies": {                  # ç”Ÿäº§ä¾èµ–
    "react": "^18.2.0",
    "react-dom": "^18.2.0"
  },
  "devDependencies": {               # å¼€å‘ä¾èµ–
    "typescript": "^5.0.0",
    "vite": "^4.0.0"
  },
  "peerDependencies": {              # åŒä¼´ä¾èµ–ï¼ˆç”±ä½¿ç”¨è€…å®‰è£…ï¼‰
    "react": ">=16.8.0"
  },
  "optionalDependencies": {          # å¯é€‰ä¾èµ–
    "fsevents": "^2.3.2"
  },
  "engines": {                       # Node ç‰ˆæœ¬è¦æ±‚
    "node": ">=14.0.0",
    "npm": ">=7.0.0"
  },
  "browserslist": [                  # ç›®æ ‡æµè§ˆå™¨
    "> 1%",
    "last 2 versions"
  ],
  "keywords": ["react", "component"],
  "author": "Your Name",
  "license": "MIT",
  "repository": {
    "type": "git",
    "url": "https://github.com/user/repo.git"
  }
}
```

### 2.3 ç‰ˆæœ¬å·è§„åˆ™

```
è¯­ä¹‰åŒ–ç‰ˆæœ¬ï¼ˆSemVerï¼‰ï¼šä¸»ç‰ˆæœ¬.æ¬¡ç‰ˆæœ¬.è¡¥ä¸ç‰ˆæœ¬

ç¤ºä¾‹ï¼š1.2.3
- 1ï¼šä¸»ç‰ˆæœ¬ï¼ˆä¸å…¼å®¹çš„ API ä¿®æ”¹ï¼‰
- 2ï¼šæ¬¡ç‰ˆæœ¬ï¼ˆå‘ä¸‹å…¼å®¹çš„åŠŸèƒ½æ–°å¢ï¼‰
- 3ï¼šè¡¥ä¸ç‰ˆæœ¬ï¼ˆå‘ä¸‹å…¼å®¹çš„ bug ä¿®å¤ï¼‰

ç‰ˆæœ¬èŒƒå›´ï¼š
- ^1.2.3ï¼š>=1.2.3 <2.0.0ï¼ˆä¸ä¿®æ”¹ä¸»ç‰ˆæœ¬ï¼‰
- ~1.2.3ï¼š>=1.2.3 <1.3.0ï¼ˆä¸ä¿®æ”¹æ¬¡ç‰ˆæœ¬ï¼‰
- * æˆ– xï¼šä»»æ„ç‰ˆæœ¬
- latestï¼šæœ€æ–°ç‰ˆæœ¬
- exactï¼šç²¾ç¡®ç‰ˆæœ¬ï¼ˆ1.2.3ï¼‰

å‰ç½®æ ‡è¯†ï¼š
- 1.0.0-alphaï¼šå†…éƒ¨æµ‹è¯•ç‰ˆ
- 1.0.0-betaï¼šå…¬æµ‹ç‰ˆ
- 1.0.0-rcï¼šå€™é€‰å‘å¸ƒç‰ˆ
```

---

## ä¸‰ã€yarn

### 3.1 å®‰è£…ä¸åŸºç¡€ç”¨æ³•

```bash
# å®‰è£… Yarn
npm install -g yarn
# æˆ–
corepack enable  # Node 16.10+ å†…ç½®

# åˆå§‹åŒ–é¡¹ç›®
yarn create react-app my-app

# å®‰è£…ä¾èµ–
yarn add react                  # ç”Ÿäº§ä¾èµ–
yarn add -D typescript          # å¼€å‘ä¾èµ–
yarn global add @vue/cli        # å…¨å±€å®‰è£…

# å¸è½½
yarn remove react

# æ›´æ–°
yarn upgrade
yarn upgrade-interactive --latest  # äº¤äº’å¼æ›´æ–°

# è¿è¡Œè„šæœ¬
yarn dev
yarn build

# æŸ¥çœ‹ä¿¡æ¯
yarn list
yarn why react                  # æŸ¥çœ‹ä¸ºä»€ä¹ˆå®‰è£…äº†æŸä¸ªåŒ…
yarn info react

# ç¼“å­˜ç®¡ç†
yarn cache clean
yarn cache dir

# å·¥ä½œåŒºï¼ˆMonorepoï¼‰
yarn workspaces info
```

### 3.2 Yarn v2+/Berry

```bash
# å‡çº§åˆ° Yarn 2+
yarn set version berry

# é…ç½®
yarn config set nodeLinker node-modules  # ä½¿ç”¨ node_modules æ¨¡å¼
yarn config set npmRegistryServer https://registry.npmmirror.com

# æ’ä»¶
yarn plugin import interactive-tools    # å®‰è£…äº¤äº’å¼å·¥å…·æ’ä»¶
yarn plugin list

# ç‰¹æ€§
- é›¶å®‰è£…ï¼ˆZero-Installsï¼‰ï¼š.pnp.cjs æ–‡ä»¶ä»£æ›¿ node_modules
- ä¸¥æ ¼æ¨¡å¼ï¼šæ›´å¿«çš„å®‰è£…é€Ÿåº¦
- æ›´å¥½çš„çº¦æŸï¼šæ”¯æŒæ›´å¤æ‚çš„ä¾èµ–å…³ç³»
```

---

## å››ã€pnpmï¼ˆæ¨èï¼‰

### 4.1 ä¸ºä»€ä¹ˆé€‰æ‹© pnpmï¼Ÿ

**æ ¸å¿ƒä¼˜åŠ¿**
1. **èŠ‚çœç£ç›˜ç©ºé—´**ï¼šä½¿ç”¨ç¡¬é“¾æ¥ï¼Œå…¨å±€åªå­˜å‚¨ä¸€ä»½
2. **å®‰è£…é€Ÿåº¦å¿«**ï¼šæ¯” npm/yarn å¿« 2-3 å€
3. **ä¸¥æ ¼çš„ä¾èµ–ç®¡ç†**ï¼šé¿å…å¹½çµä¾èµ–
4. **åŸç”Ÿæ”¯æŒ Monorepo**

### 4.2 åŸºç¡€ç”¨æ³•

```bash
# å®‰è£… pnpm
npm install -g pnpm
# æˆ–
corepack enable  # Node 16.10+ å†…ç½®

# åˆå§‹åŒ–é¡¹ç›®
pnpm init

# å®‰è£…ä¾èµ–
pnpm install              # å®‰è£…æ‰€æœ‰ä¾èµ–
pnpm add react            # ç”Ÿäº§ä¾èµ–
pnpm add -D typescript    # å¼€å‘ä¾èµ–
pnpm add -g @vue/cli      # å…¨å±€å®‰è£…

# å¸è½½
pnpm remove react

# æ›´æ–°
pnpm update
pnpm update react

# è¿è¡Œè„šæœ¬
pnpm dev
pnpm build

# æŸ¥çœ‹ä¿¡æ¯
pnpm list
pnpm why react            # æŸ¥çœ‹ä¾èµ–å…³ç³»

# å­˜å‚¨ï¼ˆç±»ä¼¼ npm cacheï¼‰
pnpm store path           # æŸ¥çœ‹å­˜å‚¨è·¯å¾„
pnpm store prune          # æ¸…ç†æ— ç”¨åŒ…
pnpm store add react@18   # æ·»åŠ åŒ…åˆ°å­˜å‚¨
```

### 4.3 Monorepo æ”¯æŒ

```bash
# åˆ›å»º Monorepo
pnpm init

# pnpm-work.yaml
packages:
  - 'packages/*'
  - 'apps/*'

# å®‰è£…æ‰€æœ‰å·¥ä½œåŒºä¾èµ–
pnpm install

# ä¸ºç‰¹å®šå·¥ä½œåŒºæ·»åŠ ä¾èµ–
pnpm --filter @my-org/ui add react

# è¿è¡Œæ‰€æœ‰å·¥ä½œåŒºçš„è„šæœ¬
pnpm -r run build
pnpm -r --parallel test  # å¹¶è¡Œæ‰§è¡Œ

# è¿‡æ»¤å·¥ä½œåŒº
pnpm --filter ./packages/ui run dev
```

---

## äº”ã€Monorepoï¼ˆå¤šåŒ…é¡¹ç›®ç®¡ç†ï¼‰

### 5.1 npm workspaces

```json
// package.json
{
  "name": "my-monorepo",
  "private": true,
  "workspaces": [
    "packages/*"
  ],
  "scripts": {
    "build": "npm run build --workspaces",
    "test": "npm run test --workspaces"
  }
}
```

```
é¡¹ç›®ç»“æ„ï¼š
my-monorepo/
â”œâ”€â”€ package.json
â”œâ”€â”€ packages/
â”‚   â”œâ”€â”€ shared/
â”‚   â”‚   â””â”€â”€ package.json
â”‚   â”œâ”€â”€ app1/
â”‚   â”‚   â””â”€â”€ package.json
â”‚   â””â”€â”€ app2/
â”‚       â””â”€â”€ package.json
```

### 5.2 Yarn workspaces

```yaml
# yarn.lockï¼ˆè‡ªåŠ¨ç”Ÿæˆï¼‰

# .yarnrc.yml
nodeLinker: node-modules
workspaces:
  - 'packages/*'
```

```json
// package.json
{
  "private": true,
  "workspaces": [
    "packages/*"
  ],
  "scripts": {
    "build": "yarn workspaces run build",
    "clean": "yarn workspaces run clean && rm -rf node_modules"
  }
}
```

### 5.3 pnpm workspace

```yaml
# pnpm-work.yaml
packages:
  - 'packages/*'
  - 'apps/*'

# å¯ä»¥æŒ‡å®šå…¬å…±ä¾èµ–
catalog:
  react: ^18.2.0
  typescript: ^5.0.0
```

```json
// package.json
{
  "private": true,
  "scripts": {
    "build": "pnpm -r --filter './packages/**' build",
    "dev": "pnpm -r --parallel --filter './apps/**' dev"
  }
}
```

### 5.4 Turborepoï¼ˆæ¨èï¼‰

```bash
# å®‰è£… Turborepo
pnpm add -D turbo

# turbo.json
{
  "$schema": "https://turbo.build/schema.json",
  "pipeline": {
    "build": {
      "dependsOn": ["^build"],
      "outputs": ["dist/**", ".next/**"]
    },
    "dev": {
      "cache": false,
      "persistent": true
    },
    "lint": {
      "outputs": []
    }
  }
}
```

```bash
# è¿è¡Œ
turbo run build    # æŒ‰ä¾èµ–é¡ºåºæ„å»º
turbo run dev      # å¹¶è¡Œå¼€å‘
```

---

## å…­ã€æœ€ä½³å®è·µ

### 6.1 ä¾èµ–ç®¡ç†

```bash
# âœ… å®šæœŸæ›´æ–°
npm outdated
npm update

# âœ… ä½¿ç”¨ lock æ–‡ä»¶
git add package-lock.json  # npm
git add yarn.lock          # yarn
git add pnpm-lock.yaml     # pnpm

# âœ… æ£€æŸ¥å®‰å…¨æ¼æ´
npm audit
npm audit fix

# âœ… æ¸…ç†æ— ç”¨ä¾èµ–
npm prune

# âœ… ç²¾ç¡®ç‰ˆæœ¬ï¼ˆç”Ÿäº§ç¯å¢ƒï¼‰
npm install react@18.2.0 --save-exact
```

### 6.2 æ€§èƒ½ä¼˜åŒ–

```bash
# ä½¿ç”¨ç¼“å­˜
npm config set cache ~/.npm-cache

# å¹¶è¡Œå®‰è£…ï¼ˆpnpmï¼‰
pnpm install --frozen-lockfile

# ä½¿ç”¨ç¦»çº¿æ¨¡å¼
npm install --prefer-offline
yarn install --offline
pnpm install --prefer-offline
```

### 6.3 å®‰å…¨å»ºè®®

```json
// package.json
{
  "engines": {
    "node": ">=14.0.0"
  },
  "scripts": {
    "preinstall": "npx only-allow pnpm"  # å¼ºåˆ¶ä½¿ç”¨ pnpm
  }
}
```

```bash
# .npmrc
registry=https://registry.npmmirror.com
//registry.npmmirror.com/:_authToken=${NPM_TOKEN}
save-exact=true
```

---

## ä¸ƒã€å¸¸è§é—®é¢˜ä¸é¿å‘æŒ‡å—

### âŒ é—®é¢˜ 1ï¼šnpm install é€Ÿåº¦æ…¢

```bash
# âœ… ä½¿ç”¨é•œåƒ
npm config set registry https://registry.npmmirror.com
# æˆ–
yarn config set registry https://registry.npmmirror.com
# æˆ–
pnpm config set registry https://registry.npmmirror.com

# âœ… ä½¿ç”¨ cnpmï¼ˆä¸æ¨èï¼Œå¯èƒ½æœ‰å…¼å®¹æ€§é—®é¢˜ï¼‰
npm install -g cnpm --registry=https://registry.npmmirror.com
```

### âŒ é—®é¢˜ 2ï¼šå¹½çµä¾èµ–

```javascript
// é¡¹ç›®å®‰è£…äº† webpack@5
// webpack ä¾èµ– lodash@4

// âœ… npm/yarnï¼šå¯ä»¥ç›´æ¥è®¿é—® lodashï¼ˆå¹½çµä¾èµ–ï¼‰
import _ from 'lodash';  // èƒ½ç”¨ï¼Œä½†ä¸å®‰å…¨

// âŒ pnpmï¼šæ— æ³•è®¿é—®å¹½çµä¾èµ–ï¼ˆæ›´å®‰å…¨ï¼‰
import _ from 'lodash';  // æŠ¥é”™

// âœ… æ­£ç¡®åšæ³•ï¼šæ˜¾å¼å®‰è£…
pnpm add lodash
```

### âŒ é—®é¢˜ 3ï¼šä¾èµ–å†²çª

```bash
# âœ… ä½¿ç”¨ resolutionsï¼ˆyarnï¼‰æˆ– overridesï¼ˆnpm/pnpmï¼‰
# package.json
{
  "resolutions": {
    "lodash": "^4.17.21"
  },
  "overrides": {
    "lodash": "^4.17.21"
  },
  "pnpm": {
    "overrides": {
      "lodash": "^4.17.21"
    }
  }
}
```

---

## å…«ã€æ€»ç»“ä¸è®°å¿†è¦ç‚¹

### ğŸ¯ æ ¸å¿ƒè®°å¿†å£è¯€

```
npm å®˜æ–¹æœ€ç¨³å®š
yarn Facebook å‡º
pnpm æ€§èƒ½æœ€ä¼˜ç§€
é€Ÿåº¦ç©ºé—´éƒ½èŠ‚çœ
Monorepo åŸç”Ÿæ”¯æŒ
ç‰ˆæœ¬å·è¯­ä¹‰åŒ–
lock æ–‡ä»¶è¦æäº¤
ä¾èµ–ç®¡ç†å®šæœŸæ›´æ–°
å®‰å…¨æ¼æ´è¦æ£€æŸ¥
æœ€ä½³å®è·µ pnpm
```

### ğŸ“š å…³é”®æŠ€æœ¯ç‚¹

1. **åŸºç¡€æ“ä½œ**ï¼šinstallã€addã€removeã€update
2. **ä¾èµ–ç±»å‹**ï¼šdependenciesã€devDependenciesã€peerDependencies
3. **ç‰ˆæœ¬è§„åˆ™**ï¼š^ã€~ã€*ã€exact
4. **Monorepo**ï¼šworkspacesã€Turborepoã€pnpm workspace
5. **æ€§èƒ½ä¼˜åŒ–**ï¼šé•œåƒã€ç¼“å­˜ã€å¹¶è¡Œå®‰è£…
6. **å®‰å…¨**ï¼šauditã€overridesã€engines

---

## ä¹ã€å®æˆ˜ç»ƒä¹ å»ºè®®

1. ç”¨ pnpm åˆå§‹åŒ–ä¸€ä¸ªæ–°é¡¹ç›®
2. åˆ›å»ºä¸€ä¸ª Monorepo é¡¹ç›®ï¼Œç®¡ç†å¤šä¸ªåŒ…
3. é…ç½® Turborepo åŠ é€Ÿæ„å»º
4. å®ç° CI/CD ä¸­çš„ä¾èµ–ç¼“å­˜
5. ç¼–å†™è„šæœ¬è‡ªåŠ¨æ£€æµ‹ä¾èµ–æ›´æ–°

---

**ä¸‹ä¸€æ­¥å­¦ä¹ **ï¼šğŸ‘‰ [ä»£ç è§„èŒƒ](./ä»£ç è§„èŒƒ.md)
